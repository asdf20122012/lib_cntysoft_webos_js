Ext.define("WebOs.Component.Window",{extend:"Ext.window.Window",statics:{vwIdSeed:1},vdesktop:null,constructor:function(a){this.vdesktop=Cntysoft.R_SYS_UI_RENDER.getOsWidget(Cntysoft.Const.WEBOS_V_DESKTOP);a=a||{};this.applyConstraintConfig(a);this.callParent([a]);this.$_vdesktop_key_$=Ext.getClassName(this)+this.statics().vwIdSeed++;this.vdesktop.registerWindow(this.$_vdesktop_key_$,this);this.$_vd_index_$=this.vdesktop.current},initComponent:function(){this.addListener({boxready:function(){this.$_x_ratio_$=this.getX()/this.vdesktop.getWidth()},move:function(){this.$_x_ratio_$=this.getX()/this.vdesktop.getWidth()},scope:this});this.callParent()},applyConstraintConfig:function(a){Ext.apply(a,{hideMode:"visibility",constrain:true,constrainTo:Ext.get("WEBOS_V_DESKTOP")})},onWindowResize:function(){var c=this,b;if(c.maximized){c.fitContainer()}else{var a=this.getX();if(a>0&&a<this.vdesktop.getWidth()){b=c.getSizeModel();if(b.width.natural||b.height.natural){c.updateLayout()}c.doConstrain()}}},destroy:function(){this.vdesktop.unregisterWindow(this.$_vdesktop_key_$,this.$_vd_index_$);delete this.$_vdesktop_key_$;delete this.vdesktop;this.callParent()}});Ext.define("WebOs.Kernel.Const",{extend:"Cntysoft.Kernel.Const",inheritableStatics:{ENV_DAEMON:"ENV_DAEMON",ENV_APP:"ENV_APP",WEBOS_TASK_BAR:"WEBOS_TASK_BAR",WEBOS_VDS:"WEBOS_VDS",WEBOS_DESKTOP:"WEBOS_DESKTOP",WEBOS_V_DESKTOP:"WEBOS_V_DESKTOP",WEBOS_SYS_MENU:"WEBOS_SYS_MENU",WEBOS_QUICK_BAR:"WEBOS_QUICK_BAR",WEBOS_START_BTN:"WEBOS_START_BTN",WEBOS_APP_SWITCH_BAR:"WEBOS_APP_SWITCH_BAR",WEBOS_SYS_TRAY:"WEBOS_SYS_TRAY",WEBOS_SYS_BG:"WEBOS_SYS_BG",WEBOS_SYS_NOTICE:"WEBOS_SYS_NOTICE",WEBOS_DESKTOP_MENU:"WEBOS_DESKTOP_MENU",WEBOS_WIN_MGR:"WEBOS_WIN_MGR",R_INIT:"RUNABLE_INIT",R_SYS_UI_RENDER:"R_SYS_UI_RENDER",R_TASK_MANAGER:"R_TASK_MANAGER",ENV_CUR_USER:"ENV_CUR_USER",ENV_ACL:"ENV_ACL_KEY",ENV_APP_RUN_RECORD:"ENV_APP_RUN_RECORD",ENV_PHP_SETTING:"ENV_PHP_SETTING",RUN_TYPE_APP:"App",RUN_TYPE_DAEMON:"Daemon",VENDER_DIR:"Vender",APP_DIR:"App",DAEMON_DIR:"Daemon",SYS_TRAY_MSG_TXT:1,SYS_TRAY_MSG_CALLBACK:2,RUN_LEVEL_KERNEL:"kernel",RUN_LEVEL_USER:"user"}},function(){alias=Ext.Function.alias;Ext.apply(WebOs,{Const:this,C:this})});Ext.define("WebOs.Lang.zh_CN",{extend:"Cntysoft.Kernel.AbstractLangHelper",data:{DESKTOP:{}}});Ext.define("WebOs.Kernel.ProcessModel.AbstractLib",{runable:null,constructor:function(a){this.runable=a},getRunable:function(){return this.runable}});Ext.define("WebOs.Kernel.ProcessModel.Runable",{mixins:{observable:"Ext.util.Observable",callApp:"Cntysoft.Mixin.CallApp"},requires:["Cntysoft.Framework.Net.Gateway","Cntysoft.Stdlib.Object","WebOs.Kernel.ProcessModel.AbstractLib"],inheritableStatics:{S_RUNNING:1,S_SLEEP:2,S_CLOSE:3},runableType:"",runLevel:"user",id:"",allowMultiInstance:false,processManager:null,process:null,sysEnv:null,status:null,invokeConfig:{},isRunned:false,runConfig:{},isKilled:false,version:{},namespace:null,hasLangText:true,lang:null,LANG_TEXT:null,isApiInvoke:false,constructor:function(a){if(Ext.isDefined(a.invokeConfig)){this.invokeConfig=a.invokeConfig;delete a.invokeConfig}this.sysEnv=WebOs.getSysEnv();this.processManager=WebOs.PM();this.mixins.observable.constructor.call(this,a);if(Ext.isEmpty(this.id)){Cntysoft.raiseError(Ext.getClassName(this),"constructor","Runable must have id property")}this.setupIdHandler();this.libRefs=new Ext.util.HashMap();if(this.hasLangText){if(!Cntysoft.LangManager.hasLang(this.id)){Ext.require(this.getLangCls());this.lang=Ext.create(this.getLangCls());Cntysoft.LangManager.register(this.id,this.lang)}else{this.lang=Cntysoft.LangManager.getLang(this.id)}}},setupIdHandler:Ext.emptyFn,getLangCls:Ext.emptyFn,GET_LANG_TEXT:function(a){if(this.hasLangText){return this.lang.getText(a)}},GET_PROCESS_DISPLAY_TEXT:function(){var a=this.GET_LANG_TEXT("PM_TEXT.DISPLAY_TEXT");if(Ext.isEmpty(a)){a="program : "+this.category+"."+this.name}return a},getNamespace:function(){if(null==this.namespace){var a=Ext.getClassName(this);this.namespace=a.substring(0,a.lastIndexOf("."))}return this.namespace},setEnvVar:function(a,b){a=["RUNABLE",this.runableType,this.id,a].join(".");this.sysEnv.set(a,b);return this},getEnvVar:function(a){a=["RUNABLE",this.runableType,this.id,a].join(".");return this.sysEnv.get(a)},setProcess:function(a){if(!a instanceof WebOs.Kernel.ProcessModel.Process){Cntysoft.raiseError(Ext.getClassName(this),"setProcess","process must be the type of WebOs.Kernel.ProcessModel.Process")}this.process=a;return this},getProcess:function(){return this.process},getInvokeConfig:function(){return this.invokeConfig},getRunConfig:function(){return this.runConfig},getRunableType:function(){return this.runableType},getId:function(){return this.id},isAllowMultiInstance:function(){return !!this.allowMutiInstance},run:function(a){var b=this.self;this.runConfig=a;this.status=b.S_RUNNING;if(""==Ext.String.trim(this.id)){Cntysoft.raiseError(Ext.getClassName(this),"run","id must not be empty")}if(this.hasListeners.run){this.fireEvent("run",this)}return this},msgNotifyHandler:Ext.emptyFn,wakeup:function(){this.status=this.self.S_RUNNING;if(this.hasListeners.wakeup){this.fireEvent("wakeup",this)}return this},sleep:function(){this.status=this.self.S_SLEEP;if(this.hasListeners.sleep){this.fireEvent("sleep",this)}return this},setStatus:function(a){if(this.status!=a){this.status=a;if(this.hasListeners.statuschange){this.fireEvent("statuschange",a,this)}}return this},getStatus:function(){return this.status},kill:function(){delete this.process;this.destroy();this.isKilled=true;this.status=this.self.S_KILLED;if(this.hasListeners.kill){this.fireEvent("kill",this)}return this},exit:function(){if(this.isApiInvoke){if("App"==this.runableType&&this.widgets.getCount()>0){if(this.widgets.getCount()>0){return}}}WebOs.PM().killProcess(this.process)},destroy:function(){this.clearListeners();delete this.processManager;delete this.sysEnv;delete this.process;delete this.LANG_TEXT;delete this.lang}},function(){Ext.apply(WebOs,{GET_APP_LANG_TEXT:function(c,a,b){var d=WebOs.PM().getAppByKey(c,a);return d.GET_LANG_TEXT(b)},GET_DAEMON_LANG_TEXT:function(c,a,b){var d=WebOs.PM().getDaemonByKey(c,a);return d.GET_LANG_TEXT(b)}})});Ext.define("WebOs.Kernel.ProcessModel.Process",{mixins:{observable:"Ext.util.Observable"},requires:["Cntysoft.Utils.Common","WebOs.Kernel.ProcessModel.Runable"],statics:{P_TYPE_APP:"App",P_TYPE_DAEMON:"Daemon",P_STATUS_EMPTY:0,P_STATUS_STOP:2,P_STATUS_RUNNING:1,PROCESS_ID_SEED:0,I_TYPE_API:0,I_TYPE_WIDGET:1,generatePid:function(){return ++this.PROCESS_ID_SEED},getSupportStatus:function(){return[this.P_STATUS_STOP,this.P_STATUS_RUNNING]},getSupportProcessTypes:function(){return[this.P_TYPE_APP,this.P_TYPE_DAEMON]}},isProcess:true,status:null,startTime:null,pid:null,runable:null,taskButton:null,runTimeTask:null,killed:false,constructor:function(a){this.startTime=new Date();this.pid=this.statics().generatePid();this.status=this.self.P_STATUS_RUNNING;this.initNotifyTimeTask();Ext.apply(this,a);this.mixins.observable.constructor.call(this,a);this.callParent([a])},load:function(a){if(!(a instanceof WebOs.Kernel.ProcessModel.Runable)){Cntysoft.raiseError(Ext.getClassName(this),"load","runable must be instanceof WebOs.Kernel.ProcessModel.Runable")}this.runable=a;a.setProcess(this);if(this.hasListeners.kernelload){this.fireEvent("kernelload",this)}},start:function(a){if(!this.isLoaded()){Cntysoft.raiseError(Ext.getClassName(this),"start","process have not kernel")}this.status=this.statics().P_STATUS_RUNNING;this.runable.run(a);if(this.hasListeners.start){this.fireEvent("start",this)}return this},isLoaded:function(){return this.runable instanceof WebOs.Kernel.ProcessModel.Runable},wakeup:function(){if(!this.isLoaded()){Cntysoft.raiseError(Ext.getClassName(this),"wakeup","process has not runable instance")}this.runable.wakeup();this.status=this.statics().P_STATUS_RUNNING;if(this.hasListeners.wakeup){this.fireEvent("wakeup",this)}return this},sleep:function(){if(!this.isLoaded()){Cntysoft.raiseError(Ext.getClassName(this),"sleep","process has not runable instance")}this.status=this.statics().P_STATUS_STOP;this.runable.sleep();if(this.hasListeners.sleep){this.fireEvent("sleep",this)}return this},kill:function(){if(!this.isLoaded()){Cntysoft.raiseError(Ext.getClassName(this),"kill","process has not runable instance")}this.runable.kill();this.killed=true;if(this.hasListeners.kill){this.fireEvent("kill",process)}return this},getProcessRunTime:function(){var a=new Date(),b=Math.floor((a-this.startTime)/60000);return b},getProcessType:function(){if(!this.isLoaded()){Cntysoft.raiseError(Ext.getClassName(this),"getProcessType","process has not runable instance")}return this.runable.getRunableType()},getStatus:function(){return this.status},getPid:function(){return this.pid},getRunable:function(){return this.runable},initNotifyTimeTask:function(){this.runTimeTask=Ext.TaskManager.start({run:function(){if(this.hasListeners.exetime){this.fireEvent("exetime",this,this.getProcessRunTime())}},interval:60000,scope:this})},destroy:function(){this.clearListeners();Ext.TaskManager.stop(this.runTimeTask);delete this.runTimeTask;delete this.taskButton;delete this.runable;this.runTimeTask=null}});Ext.define("WebOs.Kernel.ProcessModel.ProcessManager",{extend:"Ext.util.MixedCollection",requires:["WebOs.Kernel.ProcessModel.Process","Cntysoft.Stdlib.Object"],isProcesssManager:true,runableRefCache:null,constructor:function(){this.callParent([false,Ext.bind(function(a){return this.getProcessIdKey(a.pid)},this)]);this.runableRefCache=new Ext.util.HashMap({keyFn:function(a){return a.runableType+"_"+a.module+"_"+a.name}})},runApp:function(a,c,b){Ext.apply(a,{type:WebOs.Const.RUN_TYPE_APP});this.runKernel(a,c,b)},callApi:function(b,a,f,d,e,c){this.runApp({module:b,name:a,runConfig:{apiName:f,apiParams:d,callback:e,scope:c}})},runDaemon:function(a){Ext.apply(a,{type:WebOs.Const.RUN_TYPE_DAEMON});this.runKernel(a)},runKernel:function(c,g,f){var b;var a;this.checkMetaFields(c);var d;var e=c.type;if(e===WebOs.Const.RUN_TYPE_DAEMON){d=c.name}else{d=c.module+"."+c.name}Ext.applyIf(c,this.getRunableConfig(d,e));b=c.runConfig;delete c.runConfig;a=this.getClsFromConfig(c);if(!Ext.ClassManager.get(a)){WebOs.showLoadScriptMask();Ext.require(a,function(){WebOs.hideLoadScriptMask();this.doRunKernel(d,e,b,c,g,f)},this)}else{this.doRunKernel(d,e,b,c,g,f)}},doRunKernel:function(c,e,b,a,f,d){f=f||Ext.emptyFn;d=d||this;process=this.getProcessByRunableName(c,e);if(process instanceof WebOs.Kernel.ProcessModel.Process){this.startProcess(process,b);f.call(d,process);return process}process=this.createProcess(a);this.startProcess(process,b);f.call(d,process)},createProcess:function(b){var c;var a;c=new WebOs.Kernel.ProcessModel.Process(b.processConfig);delete b.processConfig;a=this.getRunableIntance(b);a.process=c;this.setupProcess(c);c.load(a);if(this.hasListeners.processcreate){this.fireEvent("processcreate",c)}return this.add(c)},startProcess:function(b,a){if(Ext.isNumber(b)){if(!this.hasProcess(b)){Cntysoft.raiseError(Ext.getClassName(this),"startProcess","process : "+b+"is not exist")}b=this.getProcess(b)}if(!(b instanceof WebOs.Kernel.ProcessModel.Process)){Cntysoft.raiseError(Ext.getClassName(this),"startProcess","process must the instanceof WebOs.Kernel.ProcessModel.Process")}b.start(a);if(this.hasListeners.processstart){this.fireEvent("processstart",b)}return b},killProcess:function(a){if(Ext.isNumber(a)){a=this.getProcess(a)}if(!(a instanceof WebOs.Kernel.ProcessModel.Process)){Cntysoft.raiseError(Ext.getClassName(this),"killProcess","process must instanceof WebOs.Kernel.ProcessModel.Process")}a.kill();this.remove(a,true);return a},sleepProcess:function(a){a=this.getProcess(a);a.sleep();if(this.hasListeners.processsleep){this.fireEvent("processsleep",a)}return a},wakeupProcess:function(a){a=this.getProcess(a);a.wakeup();if(this.hasListeners.processwakeup){this.fireEvent("processwakeup",a)}return a},sleepAllProcess:function(){this.each(function(a){this.sleepProcess(a)},this);return this},wakeupAllProcess:function(){this.each(function(a){this.wakeupProcess(a)},this);return this},killAllProcess:function(){this.each(function(a){this.killProcess(a)},this);return this},killProcessByType:function(a){if(!Ext.Array.contains(this.getSupportRunableTypes(),a)){Cntysoft.raiseError(Ext.getClassName(this),"killProcessByType","type : "+a+" is not supported")}this.each(function(b){if(a==b.runable.runableType){this.killProcess(b)}},this);return this},killProcessByRunLevel:function(b){var a=[WebOs.Const.RUN_LEVEL_KERNEL,WebOs.Const.RUN_LEVEL_USER];if(!Ext.Array.contains(a,b)){Cntysoft.raiseError(Ext.getClassName(this),"killProcessByRunLevel","level type : "+b+" is not supported")}this.each(function(c){if(b==c.runLevel){this.killProcess(c)}},this);return this},reflectStatusChange:function(a,c){var b=WebOs.Kernel.ProcessModel.App;if(c.status==a){return}switch(a){case b.S_RUNNING:this.wakeupProcess(c);break;case b.S_SLEEP:this.sleepProcess(c);break;case b.S_CLOSE:this.killProcess(c);break}},getRunableIntance:function(d){var a;var b;b=this.getClsFromConfig(d);var c={};if(d.type==WebOs.Const.RUN_TYPE_APP){c.meta={module:d.module,name:d.name,widgets:d.widgets}}else{c.meta={name:d.name}}c.invokeConfig=d.invokeConfig;return Ext.create(b,c)},getClsFromConfig:function(b){var e=WebOs.Kernel.ProcessModel.Process;var a;var c="Main";var d=Ext.app.namespaces;if(b.type==e.P_TYPE_APP){a=["App",b.module,b.name,c].join(".")}else{if(b.type==e.P_TYPE_DAEMON){a=["Daemon",b.name,c].join(".")}}return a},getProcess:function(b){var a;if(b instanceof WebOs.Kernel.ProcessModel.Process){return b}else{if(Ext.isNumber(b)){a=this.getProcessIdKey(b);b=this.getByKey(a);if(Ext.isEmpty(b)){return null}return b}else{Cntysoft.raiseError(Ext.getClassName(this),"getProcess","process must be the type of number or WebOs.Kernel.ProcessModel.Process")}}},getProcessByRunableName:function(b,c){var a;var e;var d=WebOs.Kernel.ProcessModel.Process;if(!Ext.Array.contains(d.getSupportProcessTypes(),c)){Cntysoft.raiseError(Ext.getClassName(this),"getProcessByRunableName",Ext.String.format("type : {0} is not supported",c))}this.each(function(f){a=f.getRunable();if(a.getRunableType()==c&&b==a.getId()){e=f;return false}});return e},getAppByKey:function(c,a){var b=WebOs.Const.RUN_TYPE_APP+"_"+c+"_"+a;if(!this.runableRefCache.containsKey(b)){Cntysoft.raiseError(Ext.getClassName(this),"getAppByKey",Ext.String.format("App : {0} current is not running",c+"."+a))}return this.runableRefCache.get(b)},getDaemonByKey:function(c,a){var b=WebOs.Const.RUN_TYPE_DAEMON+"_"+c+"_"+a;if(!this.runableRefCache.containsKey(b)){Cntysoft.raiseError(Ext.getClassName(this),"getDaemonByKey",Ext.String.format("Daemon : {0} current is not running",c+"."+a))}return this.runableRefCache.get(b)},hasProcess:function(a){if(Ext.isNumber(a)){return this.containsKey(this.getProcessIdKey(a))}else{if(a instanceof WebOs.Kernel.ProcessModel.ProcessModel.Process){return this.contains(a)}}return false},getAllProcess:function(){return this.items},getProcessIdKey:function(a){if(!Ext.isNumber(a)){Cntysoft.raiseError(Ext.getClassName(this),"getProcessIdKey","process id must be the type of int")}return"PID."+a},attachDefaultListeners:function(){this.addListener({add:function(a,b){this.runableRefCache.add(b.runable);if(this.hasListeners.processadd){this.fireEvent("processadd",b)}},remove:function(a){this.runableRefCache.remove(a.runable);if(this.hasListeners.processkill){this.fireEvent("processkill",a)}},scope:this})},isSysHasRunable:function(c,b,d){var e=WebOs.Kernel.ProcessModel.Process;var f=c+"."+b;var a;if(!Ext.Array.contains(e.getSupportProcessTypes(),d)){Cntysoft.raiseError(Ext.getClassName(this),"isSysHasRunable",Ext.String.format("type : {0} is not supported",d))}if(d==e.P_TYPE_APP){a=WebOs.getSysEnv().get(WebOs.Const.ENV_APP)}else{if(d==e.P_TYPE_DAEMON){a=WebOs.getSysEnv().get(WebOs.Const.ENV_DAEMON)}}return a.containsKey(f)},getRunableMetaInfo:function(a,b){var d=WebOs.Const;var c=WebOs.Kernel.ProcessModel.Process;if(!Ext.Array.contains(this.getSupportRunableTypes(),b)){Cntysoft.raiseError(Ext.getClassName(this),"getRunableMetaInfo","Runable Type : "+b+"is not supported")}if(b==c.P_TYPE_APP){runables=WebOs.getSysEnv().get(d.ENV_APP)}else{if(b==c.P_TYPE_DAEMON){runables=WebOs.getSysEnv().get(d.ENV_DAEMON)}}return;metaInfo=runables.getByKey(a);if(Ext.isEmpty(metaInfo)){Cntysoft.raiseError(Ext.getClassName(this),"getRunableMetaInfo","Runable : "+a+" is not exist , or can not be run by current user")}return metaInfo},getSupportRunableTypes:function(){var a=WebOs.Const;return[a.RUN_TYPE_APP,a.RUN_TYPE_DAEMON]},getRunableConfig:function(a,b){var c=this.getRunableMetaInfo(a,b);Ext.applyIf(c,{invokeConfig:{},processConfig:{},runConfig:{},hasServer:false,showWidgetMenu:false});return c},checkMetaFields:function(a){var b=null;if(a.type==WebOs.Const.RUN_TYPE_APP){b=["module","name"]}else{b=["name"]}if(!Cntysoft.Stdlib.Object.hasRequireKeys(a,b)){Cntysoft.raiseError(Ext.getClassName(this),"checkMetaFields","meta object need require fields")}return true},setupProcess:function(a){a.addListener("exetime",this.processRuntimeHandler,this)},processRuntimeHandler:function(a,b){if(this.hasListeners.notifytime){this.fireEvent("notifytime",a,b)}},destroy:function(){this.clearListeners();this.each(function(a){a.kill()});this.runableRefCache.clear();delete this.runableRefCache;delete this.ExtAppNs;this.clear()}});Ext.define("WebOs.Init",{requires:["Cntysoft.Kernel.SysEnv","Cntysoft.Kernel.StdPath","WebOs.Kernel.Const","WebOs.Lang.zh_CN","WebOs.Kernel.ProcessModel.ProcessManager"],mixins:{observable:"Ext.util.Observable"},SYS_INIT:1,SYS_AUTH:2,SYS_RETRIEVE_USER_INFO:3,SYS_RENDER_WEBOS:4,SYS_READY:5,processManager:null,sysReady:false,sysUiReady:false,sysEnv:null,constructor:function(){this.mixins.observable.constructor.call(this);this.processManager=new WebOs.Kernel.ProcessModel.ProcessManager();this.sysEnv=new Cntysoft.Kernel.SysEnv();this.attachDefaultListeners();this.init()},init:function(){if(this.hasListeners.beforeinit){this.fireEvent("beforeinit")}this.initGlobalRef();this.initLang();this.updateLoadMsg(this.SYS_INIT);this.initRunableReg();if(this.hasListeners.afterinit){this.fireEvent("afterinit")}},initLang:function(){var a="WebOs.Lang."+this.language;var b=Ext.create(a);Cntysoft.LangManager.register("WebOs",b);WebOs.GET_LANG_TEXT=Ext.Function.alias(b,"getText")},initGlobalRef:function(){var a=Ext.Function.alias;Ext.apply(WebOs,{PM:a(this,"getProcessManager"),getSysEnv:a(this,"getSysEnv"),isReady:a(this,"isReady"),showLoadScriptMask:a(Cntysoft,"showLoadScriptMask"),hideLoadScriptMask:a(Cntysoft,"hideLoadScriptMask"),getLangType:a(this,"getLangType"),ME:this,login:a(this,"login"),loginByCookie:a(this,"loginByCookie"),updateLoadMsg:a(this,"updateLoadMsg"),hideLoadMsg:a(this,"hideLoadMsg"),removeLoadMsg:a(this,"removeLoadMsg"),getSysUrl:a(this,"getSysUrl")})},login:Ext.emptyFn,loginByCookie:Ext.emptyFn,setupSysEventHandlers:function(){window.onbeforeunload=function(){return Cntysoft.LangManager.getLang("System").getText("MSG.SYS_RELOAD_INFO")}},initRunableReg:function(){var a=Cntysoft.Utils.Common;var b=function(c){return c.module+"."+c.name};this.sysEnv.set(WebOs.Const.ENV_APP,a.generateCollection(this.getBootstrapApps(),b));this.sysEnv.set(WebOs.Const.ENV_DAEMON,a.generateCollection(this.getBootstrapDeamons(),function(c){return c.name}))},getLangType:function(){return this.language},getLangTypes:function(){return this.langTypes},getLoadMsg:function(a){if(0==a){return"loading files"}var b=this.GET_LANG_TEXT("SYS_LOADING_MSG");return b[a]},updateLoadMsg:function(a){var b=this.getLoadMsg(a)+"...";Ext.fly("loading-msg").update(b)},removeLoadMsg:function(){Ext.fly("loading").remove();Ext.fly("loading-mask").remove()},hideLoadMsg:function(){Ext.fly("loading-mask").hide()},showLoadMsg:function(a){Ext.fly("loading-mask").show()},getBootstrapDeamons:function(){return[{name:"Init"},{name:"Kernel"}]},getBootstrapApps:function(){return[{name:"Login",module:"Sys",icon:false,hasServer:true,type:"App",showWidgetMenu:false,showOnDesktop:false},{name:"SysUiRender",module:"Sys",icon:false,hasServer:false,type:"App",runConfig:{type:3},showOnDesktop:false}]},getProcessManager:function(){return this.processManager},run:function(){this.createInitRunable();if(this.hasListeners.run){this.fireEvent("run",this)}},createInitRunable:function(){WebOs.PM().runDaemon({name:"Init"})},getSysEnv:function(){return this.sysEnv},isReady:function(){return this.sysReady},getSysUrl:function(){var a=Cntysoft.Global.getDomainInfo();return a.domain},attachDefaultListeners:function(){this.addListener({desktopready:{fn:this.desktopReadyHandler,scope:this}})},desktopReadyHandler:function(){this.hideLoadMsg();this.sysReady=true},getRunableLangCls:function(b,a,c){if(c!==WebOs.Const.RUN_TYPE_APP&&c!==WebOs.Const.RUN_TYPE_DAEMON){Cntysoft.raiseError(Ext.getClassName(this),"getAppLangCls","runable type : "+c+" is not supported")}return[c,b,a,"Lang",WebOs.getLangType()].join(".")}});Ext.define("WebOs.Kernel.ProcessModel.AbstractWidget",{extend:"WebOs.Component.Window",inheritableStatics:{S_RUNNING:1,S_SLEEP:2,S_INIT:3},application:null,widgetManager:null,status:-1,taskButton:null,taskButtonText:"",name:"",hasZindexEventProvide:true,lang:null,pmText:null,LANG_TEXT:null,moving:false,vdesktop:null,constructor:function(a){a=a||{};this.applyConstraintConfig(a);if(!(a.application instanceof WebOs.Kernel.ProcessModel.App)){Cntysoft.raiseError(Ext.getClassName(this),"constructor","config must have application field and must be the type of WebOs.Kernel.ProcessModel.App")}Ext.apply(this,{application:a.application});delete a.application;this.initLangTextRef();this.callParent([a]);this.status=this.self.S_INIT},initLangTextRef:Ext.emptyFn,initComponent:function(){this.attachDefaultListeners();this.callParent()},applyConstraintConfig:function(a){this.callParent([a]);Ext.apply(a,{layout:"fit",bodyStyle:"background:#ffffff",minimizable:true,bodyPadding:1,closable:true,hidden:false,constrain:true,constrainTo:Ext.get("WEBOS_V_DESKTOP")})},GET_LANG_TEXT:function(a){return this.application.GET_LANG_TEXT(a)},GET_PM_TEXT:function(a){var a="PM_TEXT."+a;return this.GET_LANG_TEXT(a)},getApplication:function(){return this.application},getPermissionTree:function(){return this.application.permissionTree},hasPermission:function(a){return this.application.hasPermission(a)},getPermissionNode:function(a){return this.application.getPermissionNode(a)},getStatus:function(){return this.status},doClose:function(b,a){this.fireEvent("close",this);this.destroy()},show:function(b,a,e,c){if(a){e=Ext.isFunction(e)?e:Ext.emptyFn;c=c||this;if(!this.moving){this.moving=true;this.setupBeforeShow(b);var d=this;this.callParent([this.animTarget,function(){e.call(this);d.moving=false},c])}}else{this.moving=false;this.setupBeforeShow(b);this.callParent()}},setupBeforeShow:Ext.emptyFn,close:function(){if(this.fireEvent("beforeclose",this)!==false){this.application.selfOperation=true;this.application.closeWidget(this.name)}},setZIndex:function(a){if(this.hasListeners.zindexchange){this.fireEvent("zindexchange",a)}return this.callParent([a])},attachDefaultListeners:function(){this.addListener({minimize:this.minimizeHandler,show:this.showHandler,activate:this.activateHandler,afterrender:this.setWidgetPmTextHandler,scope:this})},minimizeHandler:function(a){this.application.selfOperation=true;this.application.hideWidget(a.name,true)},doMinimize:function(a){if(a){if(!this.moving){this.moving=true;this.hide(this.animTarget,function(){if(this.hasListeners.statuschange){this.fireEvent("statuschange",this,this.status)}this.taskButton.toggle(false);this.moving=false},this)}}else{this.hide(false);if(this.hasListeners.statuschange){this.fireEvent("statuschange",this,this.status)}this.moving=false;this.taskButton.toggle(false)}},showHandler:function(){this.status=this.self.S_RUNNING;if(this.hasListeners.statuschange){this.fireEvent("statuschange",widget,this.status)}this.taskButton.toggle(true)},activateHandler:function(){this.taskButton.toggle(true)},setWidgetPmTextHandler:function(){if(undefined==this.title){this.setTitle(this.pmText.WIDGET_TITLE)}if(""==this.taskButtonText){this.taskButtonText=this.pmText.TASK_BTN_TEXT;this.taskButton.setText(this.taskButtonText)}},destroy:function(){delete this.application;delete this.taskButton;delete this.animTarget;delete this.widgetManager;delete this.LANG_TEXT;this.callParent()}});Ext.define("WebOs.Kernel.ProcessModel.App",{extend:"WebOs.Kernel.ProcessModel.Runable",requires:["Cntysoft.Utils.Common","Cntysoft.Stdlib.Object"],mixins:{callApp:"Cntysoft.Mixin.CallApp"},isApp:true,runableType:"App",widgetManager:null,widgetMap:{},widgets:null,dataPool:{},selfOperation:true,selfWakeup:false,cache:null,permissionTree:null,constructor:function(a){var b=WebOs.getSysEnv().get(WebOs.Const.ENV_ACL);if(b&&b.hasOwnProperty(this.id)){this.permissionTree=b[this.id]}this.widgets=new Ext.util.HashMap({keyFn:function(c){return c.name}});this.callParent([a]);this.setupApp();this.cache=new Ext.util.HashMap()},setupApp:function(){},setupIdHandler:function(){var a=this.id.split(".");this.module=a[0];this.name=a[1]},getLangCls:function(){return[WebOs.Const.RUN_TYPE_APP,this.module,this.name,"Lang",WebOs.getLangType()].join(".")},run:function(b){var a;var d=[];var e;var c;this.callParent([b]);if(!Ext.isEmpty(b)&&!Ext.isEmpty(b.widgetName)){if(undefined==this.widgetMap[b.widgetName]){Cntysoft.raiseError(Ext.getClassName(this),"run","Widget : "+b.widgetName+" is not exist")}this.showWidget(b.widgetName,b.widgetConfig);if(undefined===this.process.$_invoke_type_$){this.process.$_invoke_type_$=Ext.getClass(this.process).I_TYPE_WIDGET}return}if(undefined===this.process.$_invoke_type_$){this.process.$_invoke_type_$=Ext.getClass(this.process).I_TYPE_API}if(!Ext.isDefined(b.apiName)){Cntysoft.raiseError(Ext.getClassName(this),"run","you call APP`s API, but have no API Name in runConfig")}a=b.apiName;if(!Ext.isDefined(this[a])||!Ext.isFunction(this[a])){Cntysoft.raiseError(Ext.getClassName(this),"run","Api : "+a+" is not exist or is not a function")}if(Ext.isDefined(b.apiParams)&&Ext.isArray(b.apiParams)){d=b.apiParams}e=b.callback||Ext.emptyFn;c=b.scope||this;d.push(e,c);this.isApiInvoke=true;this[a].apply(this,d)},getAclData:function(){return this.sysEnv.get(WebOs.Const.ENV_ACL)},kill:function(){this.selfOperation=false;this.widgets.each(function(a){this.closeWidget(a)},this);this.selfOperation=true;this.callParent();return this},wakeup:function(){this.selfOperation=false;if(!this.selfWakeup){this.widgets.each(function(a){this.showWidget(a,{},true)},this)}this.selfWakeup=false;this.selfOperation=true;this.callParent();return this},sleep:function(){this.selfOperation=false;this.widgets.each(function(a){this.hideWidget(a,true)},this);this.selfOperation=true;this.callParent()},getPermissionTree:function(){return this.permissionTree},hasPermission:function(a){return Cntysoft.Stdlib.Object.hasKeyPath(this.permissionTree,a)},getPermissionNode:function(a){return Cntysoft.Stdlib.Object.followPath(this.permissionTree,a)},getWidget:function(c,b,e,f,d){b=b||{};e=Ext.isBoolean(e)?e:true;f=f||Ext.emptyFn;d=d||this;if(undefined!=(widget=this.widgets.get(c))&&widget instanceof WebOs.Kernel.ProcessModel.AbstractWidget){if(e){return widget}f.call(d,widget,true);return}if(!Ext.isEmpty(this.widgetMap[c])){var a=this.widgetMap[c];Ext.apply(b,{application:this,listeners:{close:this.widgetCloseHandler,scope:this}});WebOs.showLoadScriptMask();Ext.require(a,function(){Cntysoft.hideLoadScriptMask();widgetObject=Ext.create(this.widgetMap[c],b);if(!(widgetObject instanceof WebOs.Kernel.ProcessModel.AbstractWidget)){Cntysoft.raiseError(Ext.getClassName(this),"getWidget","widgetObject must be instanceof of Web.Kernel.ProcessModel.AbstractWidget")}this.setupWidget(c,widgetObject);this.widgets.add(widgetObject);f.call(d,widgetObject,false)},this)}else{Cntysoft.raiseError(Ext.getClassName(this),"getWidget","widget :"+c+" is not exist")}},setupWidget:function(a,b){if(""==Ext.String.trim(widgetObject.name)){widgetObject.name=a}},showWidget:function(b,a,d,c){a=a||{};c=c||{};this.getWidget(b,a,false,function(l,k){var h=Ext.isFunction(c.beforeShowHandler)?c.beforeShowHandler:Ext.emptyFn;var f=Ext.isFunction(c.afterShowHandler)?c.afterShowHandler:Ext.emptyFn;var i=c.scope?c.scope:this;var g;var e=WebOs.Kernel.ProcessModel.AbstractWidget;if(undefined==l.taskButton){g=this.self.TASK_BAR.addTaskButton({id:this.process.pid+"_"+l.name,widget:l});this.setTaskButton(l,g)}l.addListener("beforeshow",function(){h.call(i,l)},this,{single:true});l.addListener("show",function(){f.call(i,l)},this,{single:true});if(l.status!==e.S_RUNNING&&!l.moving){if(k){var j=a.widgetExistHandler||Ext.emptyFn;var i=a.scope||{};j.call(i,l)}l.show(a,d);l.status=e.S_RUNNING;if(this.selfOperation){this.checkRuntimeStatus()}}else{if(l.status==e.S_RUNNING&&l!=Ext.WindowManager.getActive()){l.toFront()}}},this)},hideWidget:function(b,d){var c=this.getWidget(b),a=WebOs.Kernel.ProcessModel.AbstractWidget;if(c.status!==a.S_SLEEP&&!c.moving){c.doMinimize(d);c.status=a.S_SLEEP;if(this.selfOperation){this.checkRuntimeStatus()}}return this},closeWidget:function(a){var b=this.getWidget(a);this.widgets.remove(b);if(this.selfOperation){this.checkRuntimeStatus()}b.doClose()},checkRuntimeStatus:function(){var a=this.getRuntimeStatus();if(a!=this.status){this.selfOperation=true;WebOs.PM().reflectStatusChange(a,this.process);if(this.hasListeners.statuschange){this.fireEvent("statuschange",this,this.status,a);this.status=a}}},getRuntimeStatus:function(){var a=-1;var c=WebOs.Kernel.ProcessModel.App;W=WebOs.Kernel.ProcessModel.AbstractWidget;var b=false;if(0==this.widgets.getCount()){a=c.S_CLOSE}else{this.widgets.each(function(d,e){if(e.status==W.S_RUNNING){b=true}});if(b){a=c.S_RUNNING}else{a=c.S_SLEEP}}return a},getData:function(a){return this.dataPool[a]},setData:function(a,b){this.dataPool[a]=b;return this},statusChangeHandler:function(a){if(this.openReflection){WebOs.PM().reflectStatusChange(a,this.process)}},widgetCloseHandler:function(b){var a=this.self;a.TASK_BAR.removeTaskButton(b.taskButton.id)},setTaskButton:function(b,a){b.taskButton=a;b.on("show",function(){this.animTarget=a.el},b,{single:true})},destroy:function(){delete this.permissionTree;this.widgets.clear();Ext.destroy(this.widgets);delete this.widgets;this.cache.clear();this.cache=null;delete this.cache;this.callParent()}});Ext.define("WebOs.Kernel.ProcessModel.Daemon",{extend:"WebOs.Kernel.ProcessModel.Runable",mixins:{callSys:"Cntysoft.Mixin.CallSys"},runableType:"Daemon",isRunable:true,scriptName:"DaemonGateway",taskRunner:null,tasks:null,constructor:function(a){var b=this;b.callParent([a]);this.tasks=new Ext.util.MixedCollection();if(this.hasLangText){this.LANG_TEXT=this.GET_LANG_TEXT()}b.setupDaemon()},setupDaemon:Ext.emptyFn,getLangCls:function(){return[WebOs.Const.RUN_TYPE_DAEMON,this.name,"Lang",WebOs.getLangType()].join(".")},setupIdHandler:function(){this.name=this.id},run:function(a){this.callParent([a]);this.setupTask()},callService:function(d,b,c,a){this.callSys("dispatcherRequest",{key:this.name,method:d,args:b},c,a)},getTask:function(a){return this.tasks.get(a)},createTask:function(d,c,b){var e=this.getTaskRunner();var a;var b=!!b;a=e.newTask(c);this.tasks.add(d,a);if(b){a.start()}return a},getTaskRunner:function(){if(null==this.taskRunner){this.taskRunner=new Ext.util.TaskRunner()}return this.taskRunner},setupTask:Ext.emptyFn,destroy:function(){this.callParent();if(this.taskRunner){this.taskRunner.destroy()}this.tasks.clear();this.tasks.clearListeners()}});Ext.define("WebOs.Kernel.StdHandler",{statics:{CODE_MAP:{RUN_APP:1,SHOW_DESKTOP:2,ADD_FAVORITE:3,OPEN_APP_SHOP:4,SYS_SETTING:5,CONTROLL_PANEL:6,OPEN_DOC:7,ADVANCE:8,BBS:9,WEIBO:10,ABORT_CNTYSOFT:11,LOGOUT:12,LOCK_SYS:13,TILE_WINDOW:14,CASCADE_WINDOW:15,SHOW_APP_INFO:16,MOVE_ICON:17,CHANGE_WALLPAPER:18,GOTO_FRONT:19,MV_APP_TO_VD:20}},constructor:function(){var a=this.self.CODE_MAP;var b={};b[a.RUN_APP]=this.runApp;this.self.ACTION_MAP=b},request:function(c,a){var d=this.self.ACTION_MAP;var b;if(!d.hasOwnProperty(c)){Cntysoft.raiseError(Ext.getClassName(this),"request",arguments.callee.displayName+" CODE :"+c+" is not support")}if(!Ext.isDefined(a)){a=[]}if(!Ext.isArray(a)){Cntysoft.raiseError(Ext.getClassName(this),"request",arguments.callee.displayName+" arg must be the type of the array")}b=d[c];return b.apply(this,a)},runApp:function(c,b,a){WebOs.PM().runApp({module:c,name:b,runConfig:a})}});Ext.define("WebOs.Mixin.RunableLangTextProvider",{runableLangKey:null,LANG_TEXT:null,GET_LANG_TEXT:function(c){var g;var h=this.runableLangKey;if(Ext.isArray(h)){var a=h.length;var f;for(var b=0;b<a;b++){f=h[b];if(!Cntysoft.LangManager.hasLang(f)){this.loadLang(f)}g=Cntysoft.LangManager.getLang(f);try{return g.getText(c)}catch(d){continue}}Cntysoft.raiseError(Ext.getClassName(this),"GET_LANG_TEXT",c+" is not exist")}else{if(!Cntysoft.LangManager.hasLang(h)){this.loadLang(h)}g=Cntysoft.LangManager.getLang(h);return g.getText(c)}},GET_ROOT_LANG_TEXT:function(){var a;var b=this.runableLangKey;if(!Cntysoft.LangManager.hasLang(b)){this.loadLang(b)}a=Cntysoft.LangManager.getLang(b);return a.getAllLangText()},loadLang:function(b){var c=b.split(".");if(3!=c.length){Cntysoft.raiseError(Ext.getClassName(this),"loadLang","Key format error, like this type.module.name")}var a=WebOs.ME.getRunableLangCls(c[1],c[2],c[0]);Cntysoft.LangManager.register(b,Ext.create(a))},destroy:function(){delete this.LANG_TEXT;this.callParent()}});Ext.define("WebOs.OsWidget.TopStatusBar",{extend:"Ext.container.Container",requires:["Ext.layout.container.HBox"],initComponent:function(){Ext.apply(this,{layout:"hbox",height:30,items:[this.getStartupButtonConfig(),this.getMenuBarConfig(),this.getAdviceButtonConfig()]});this.callParent()},getMenuBarConfig:function(){return{xtype:"container",flex:1,style:"background : #cccccc"}},getStartupButtonConfig:function(){return{xtype:"button",text:"C",cls:"webos-status-btn"}},getAdviceButtonConfig:function(){}});Ext.define("WebOs.OsWidget.Desktop",{extend:"Ext.container.Viewport",requires:["Ext.layout.container.Border","WebOs.OsWidget.TopStatusBar"],constructor:function(a){a=a||{};this.LANG_TEXT=WebOs.GET_LANG_TEXT("DESKTOP");Ext.apply(a,{id:WebOs.Const.WEBOS_DESKTOP,layout:{type:"border"},listeners:{afterrender:function(){WebOs.ME.fireEvent("desktopready")},scope:this}});this.callParent([a])},initComponent:function(){Ext.apply(this,{items:[new WebOs.OsWidget.TopStatusBar({region:"north"}),{xtype:"panel",title:"asdasdasd",region:"center",html:"asdasdadasasdasdsa"}]});this.callParent()},destroy:function(){delete this.LANG_TEXT;this.callParent()}});